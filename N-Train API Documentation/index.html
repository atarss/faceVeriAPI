<html>
  <head>
    <title>N-Train API Documentation</title>
    <script type="text/javascript" src="script/shCore.js"></script>
    <script type="text/javascript" src="script/shBrushJScript.js"></script>
    <script type="text/javascript" src="script/shBrushXml.js"></script>
    <link href="css/shCore.css" rel="stylesheet" type="text/css" />
    <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />
    <style>
    div.form {
      border-style : solid;
      border-color : black;
      border-width : 2px;
      padding : 15px;
    }
    .date {
      text-align: right;
    }
    </style>
  </head>
  <body style="width : 800px">
    <h1>N-Train API Documentation</h1>
    <p class="date"><a href="mailto:liuyuxuan@bupt.edu.cn">Yuxuan Liu</a><br />Date : 2014.04.29</p>
    <p>API Address : <a href="http://123.127.237.160:8080/ntrain_api">http://123.127.237.160:8080/ntrain_api</a></p>
    <p>All API requests should be used in HTTP POST method. Sending an HTTP GET request will get an error(you can simply click on the API Address above to test it). For "<a href="#upload_image">upload_image</a>" and "<a href="#detect_tmp_face">detect_tmp_face</a>" API method, in order to upload a file, the form should be set to 'enctype="multipart/form-data"'.</p>
    <p>To get more information, view HTML source code of 'Demo' part.</p>
    <ul>
      <li>
        <a href="#training_api_methods">Training API Methods</a>
        <ul>
          <li><a href="#create_session">create_session</a></li>
          <li><a href="#upload_image">upload_image</a></li>
          <li><a href="#submit_face">submit_face</a></li>
          <li><a href="#check_session_status">check_session_status</a></li>
        </ul>
      </li>
      <li>
        <a href="#comparing_api_methods">Comparing API Methods</a>
        <ul>
          <li><a href="#detect_tmp_face">detect_tmp_face</a></li>
          <li><a href="#compare_image">compare_image</a></li>
        </ul>
      </li>
      <li>
        <a href="#model_api_methods">Model API Methods</a>
        <ul>
          <li><a href="#get_model_list">get_model_list</a></li>
          <li><a href="#get_img_base64">get_img_base64</a></li>
        </ul>
      </li>
    </ul>
    <hr />
    <h2 id="training_api_methods">Training API Methods</h3>
    <p>API methods in this part show how to use N-Train API training a model with at least 8 faces.</p>
    <h3 id="create_session">Method : create_session</h3>
    <p>To train a new model, telling server to create a new training session is necessary. </p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'create_session'</li>
      <li>alias : Optional. You can specify a model name of a new model. If it is not specified, server will generated a name same as session ID.</li>
    </ul>
    <h4>Response</h4>
    <pre class="brush : js">
    {
      "sessionId":0,
      "alias":"0"
    }
    </pre>
    <ul>
      <li>'SessionId' is the session ID to be trained.</li>
      <li>'alias' is the alias of this session. It may be provided by user or generated by server.</li>
    </ul>
    <h4>Demo</h4>
    <p>There is a demo form below. Simply choose a JPEG file and test for result.</p>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post">
        method : <input type="text" name="method" value="create_session"><br />
        alias : <input type="text" name="alias" value=""><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h3 id="upload_image">Method : upload_image</h3>
    <p>Upload a JPEG file to a training session in order to find out faces on the image.</p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'upload_image'</li>
      <li>session_id : ID of a session where image file will be uploaded.</li>
      <li>imgfile : File content of a JPEG file. You must upload image/jpeg type image(extension name is not limited).</li>
      <strong>'multipart/form-data' form type is requied to upload a file.</strong>
    </ul>
    <h4>Response</h4>
    <p>Using 'demo.jpg' in documentation folder, the response is like this : </p>
    <pre class="brush : js">
    {
      "id":2,
      "result":
        [{"rectId":0,
          "x":35,
          "y":35,
          "w":49,
          "h":49,
          "points":[{"x":77,"y":47},{"x":73,"y":44},{"x":63,"y":46},{"x":68,"y":46},{"x":42,"y":45},{"x":46,"y":42},{"x":54,"y":46},{"x":50,"y":45},{"x":45,"y":50},{"x":49,"y":48},{"x":53,"y":50},{"x":49,"y":51},{"x":49,"y":49},{"x":73,"y":51},{"x":69,"y":49},{"x":65,"y":51},{"x":69,"y":53},{"x":69,"y":51},{"x":52,"y":65},{"x":57,"y":67},{"x":63,"y":66},{"x":48,"y":73},{"x":57,"y":71},{"x":66,"y":74},{"x":57,"y":77},{"x":57,"y":75},{"x":57,"y":63}]
        }],
      "time":685
    }
    </pre>
    <ul>
      <li>'id' is the image ID of the uploaded file in this training session, which will be used in <a href="#submit_face">submit_face</a> method.</li>
      <li>'result' is an array. Each object in this array is a face detected in this image.</li>
      <li>'time' means detection time in milliseconds, calculated by server, ignoring time used on network transmission.</li>
      <li>'rectId' is the index of this face in the picture.</li>
      <li>'x' and 'y' is the top left position of this face rectangle. 'w' and 'h' means width and height.</li>
      <li>'points' is an array of landmark points</li>
    </ul>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post" enctype="multipart/form-data">
        method : <input type="text" name="method" value="upload_image"><br />
        session_id : <input type="text" name="session_id" value="0"><br />
        imgfile : <input type="file" name="imgfile"><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h3 id="submit_face">Method : submit_face</h3>
    <p>Start the training process by sending sample faces. To use this method, an array consisted of json objects is required. The object needs 'faceId' and 'picId' fields. Then this array should be converted to JSON format and then sended to server as a JSON string.</p>
    <p>To start a training process, 8 or more faces are required.</p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'submit_face'</li>
      <li>session_id : Session ID.</li>
      <li>json_data : JSON string of the object array. View 'Demo' part for more information.</li>
    </ul>
    <h4>Response</h4>
    <p>If the training process has been started, server will response a 'result=1'</p>
    <pre class="brush : js">
    {
      "result" : 1
    }
    </pre>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post">
        method : <input type="text" name="method" value="submit_face"><br />
        session_id : <input type="text" name="session_id" value="0"><br />
        json_data : <input style="width : 600px;" type="text" name="json_data" value='[{"picId":0,"faceId":0},{"picId":1,"faceId":0},{"picId":2,"faceId":0},{"picId":3,"faceId":0},{"picId":4,"faceId":0},{"picId":5,"faceId":0},{"picId":6,"faceId":0},{"picId":7,"faceId":0}]'><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h3 id="check_session_status">Method : check_session_status</h3>
    <p>The training process will take a long time about 15 seconds. So server will not return a success signal after train ends. As a result, client should check training status mannually.</p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'check_session_status'</li>
      <li>session_id : Session ID.</li>
    </ul>
    <h4>Response</h4>
    <pre class="brush : js">
    {
      "id" : 0,
      "status" : -1
    }
    </pre>
    <ul>
      <li>id : Session ID</li>
      <li>status : A number. -1 means not have been trained. 0 means the model is now being trained. 1 means the model has already been trained.</li>
    </ul>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post">
        method : <input type="text" name="method" value="check_session_status"><br />
        session_id : <input type="text" name="session_id" value="0"><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h2 id="comparing_api_methods">Comparing API Methods</h2>
    <p>After a model has been trained, you can use this model by choosing some sample faces and compare them with the model. However, before testing a face, the face information should be finded out from a picture file.</p>
    <h3 id="detect_tmp_face">Method : detect_tmp_face</h3>
    <p>Upload a picture and figure out face information on the picture. It is like <a href="#upload_image">upload_image</a> method but 'session_id' is not required. Same as <a href="#upload_image">upload_image</a> method, form set to <strong>'enctype="multipart/form-data"'</strong> is necessary.</p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'detect_tmp_face'</li>
      <li>imgfile : File content of a JPEG file. You must upload image/jpeg type image(extension name is not limited).</li>
      <strong>'multipart/form-data' form type is requied to upload a file.</strong>
    </ul>
    <h4>Response</h4>
    <p>Using 'demo.jpg' in documentation folder, the response is like this : </p>
    <pre class="brush : js">
    {
      "id":2,
      "result":
        [{"rectId":0,
          "x":35,
          "y":35,
          "w":49,
          "h":49,
          "points":[{"x":77,"y":47},{"x":73,"y":44},{"x":63,"y":46},{"x":68,"y":46},{"x":42,"y":45},{"x":46,"y":42},{"x":54,"y":46},{"x":50,"y":45},{"x":45,"y":50},{"x":49,"y":48},{"x":53,"y":50},{"x":49,"y":51},{"x":49,"y":49},{"x":73,"y":51},{"x":69,"y":49},{"x":65,"y":51},{"x":69,"y":53},{"x":69,"y":51},{"x":52,"y":65},{"x":57,"y":67},{"x":63,"y":66},{"x":48,"y":73},{"x":57,"y":71},{"x":66,"y":74},{"x":57,"y":77},{"x":57,"y":75},{"x":57,"y":63}]
        }],
      "time":685
    }
    </pre>
    <ul>
      <li>'id' is the temp image ID, which will be used in <a href="#submit_face">submit_face</a> method.</li>
      <li>'result' is an array. Each object in this array is a face detected in this image.</li>
      <li>'time' means detection time in milliseconds, calculated by server, ignoring time used on network transmission.</li>
      <li>'rectId' is the index of this face in the picture.</li>
      <li>'x' and 'y' is the top left position of this face rectangle. 'w' and 'h' means width and height.</li>
      <li>'points' is an array of landmark points.</li>
    </ul>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post" enctype="multipart/form-data">
        method : <input type="text" name="method" value="detect_tmp_face"><br />
        imgfile : <input type="file" name="imgfile"><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h3 id="compare_image">Method : compare_image</h3>
    <p>Compare similarity between a image and the model</p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'compare_image'</li>
      <li>session_id : Session ID of the model.</li>
      <li>img_id : Image ID got from <a href="#detect_tmp_face">detect_tmp_face</a>.</li>
      <li>face_id : Face ID in the image got from <a href="#detect_tmp_face">detect_tmp_face</a>.</li>
    </ul>
    <h4>Response</h4>
    <p>Using 'demo.jpg' in documentation folder, the response is like this : </p>
    <pre class="brush : js">
    {
      "result":0.998137,
      "time":685
    }
    </pre>
    <ul>
      <li>'result' is the similarity between image and the model.</li>
      <li>'time' means comparing time counted in milliseconds, calculated by server, ignoring time used on network transmission.</li>
    </ul>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post">
        method : <input type="text" name="method" value="compare_image"><br />
        session_id : <input type="text" name="session_id" value="1"><br />
        img_id : <input type="text" name="img_id" value="0"><br />
        face_id : <input type="text" name="face_id" value="0"><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h2 id="model_api_methods">Model API Methods</h2>
    <p>API methods in this part shows how to get brief information of previously trained model.</p>
    <h3 id="get_model_list">Method : get_model_list</h3>
    <p>List the models which have already been trained. These models can be used for <a href="#comparing_api_methods">Comparing API Methods</a></p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'get_model_list'</li>
    </ul>
    <h4>Response</h4>
    <pre class="brush : js">
    [
      {"id":1,"alias":"Obama"},
      {"id":2,"alias":"hollande"},
      {"id":6,"alias":"6"},
      {"id":7,"alias":"7"}
    ]
    </pre>
    <p>The response is an array of trained model, offering 'id' and 'alias' properties.
    <ul>
      <li>'id' is the session ID of a trained model.</li>
      <li>'alias' is the name of a trained model.</li>
    </ul>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post">
        method : <input type="text" name="method" value="get_model_list"><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <hr />
    <h3 id="get_img_base64">Method : get_img_base64</h3>
    <p>This API method privides to get thumbnail image of a trained model. Sometime, alias cannot describe a model correctly and user may need to view sample images of a trained model. As a result, this method can return the image in base64 string.</p>
    <h4>Required parameters</h4>
    <ul>
      <li>method : 'get_img_base64'</li>
      <li>session_id : Model session ID</li>
      <li>img_id : The nth image used in training process. Pictures uploaded but not used in training process will not be returned. So this ID is not ID in <a href="#upload_image">upload_image</a> method. For example, if #0, #1 #3, #4, #6... images were chosen to be trained, and img_id=2 is provided in this method, server will response #3 image uploaded in upload_image method.</li>
    </ul>
    <h4>Response</h4>
    <pre class="brush : js">
    {
      "session_id":1,
      "img_id":1,
      "base64_str":"/9j/4AAQSkZJRgABAQAAA......"
    }
    </pre>
    <ul>
      <li>base64_str : Base-64 encoded JPEG image file. "/9j/" is like a file header of a JPEG file in this base64 string</li>
    </ul>
    <h4>Demo</h4>
    <div class="form">
      <form action="http://123.127.237.160:8080/ntrain_api" method="post">
        method : <input type="text" name="method" value="get_img_base64"><br />
        session_id : <input type="text" name="session_id" value="1"><br />
        img_id : <input type="text" name="img_id" value="1"><br />
        <input type="submit" value="submit">
      </form>
    </div>
    <script type="text/javascript">
      SyntaxHighlighter.all();
    </script>
  </body>
</html>